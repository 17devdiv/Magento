<?php 
/**
 * Dotsquares
 * 
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade this extension to newer
 * version in the future.
 *
 * @author Dotsquares
 * @package Dotsquares_GDPR
 * @copyright Copyright (c) Dotsquares (https://www.dotsquares.com/)
 */

$objectManager = \Magento\Framework\App\ObjectManager::getInstance();
$customerSession = $objectManager->get('Magento\Customer\Model\Session');
$customer_collection = $objectManager->create('Magento\Customer\Model\Customer')->load($customerSession->getCustomerId());
$helper = $objectManager->create('Dotsquares\Gdpr\Helper\Data');
$email = $customer_collection->getEmail();
$customer_id = $customer_collection->getId();
$count = $helper->getOrdersize($customer_id,$email);
$blockObj = $block->getLayout()->createBlock('Dotsquares\Gdpr\Block\Permission');
$deletecusotmer_enable = $helper->getConfig('cusotmerdelete/general/deletecusotmer_enable');
$willcustomerdata = $helper->getConfig('cusotmerdelete/general/willcustomerdata');
$delete_data = explode(",",$willcustomerdata);
$html = 'Please confirm to delete your account from the website.';
foreach($delete_data as $delete):
	if($delete == 'order'){
	    $html .= " Replace all customer's data to another data in the customer's sales order.";
	}
endforeach;
if($deletecusotmer_enable == 1): ?>
        <form class="form form-customer-delete" action="<?php echo $block->getAction() ?>" method="post" id="form-validate">
            <?php if($count > 0): ?>
			<fieldset class="fieldset">
				<legend class="legend"><span><?php echo 'Customer Order\'s Details'; ?></span></legend>
                <div class="field choice">
					<p class="order_details">
						<span><?php echo "Completed Orders"?></span>
						<span><?php echo "Pending Orders"?></span>
						<span><?php echo "Processing Orders"?></span>
						<span><?php echo "Total Orders"?></span>
					</p>
					<p class="order_content">
						<span><?php echo $helper->getCompletedorder($customer_id,$email); ?></span>
						<span><?php echo $helper->getPendingorder($customer_id,$email); ?></span>
						<span><?php echo $helper->getProcessingorder($customer_id,$email); ?></span>
						<span><?php echo $count; ?></span>
					</p>
                </div>
            </fieldset>
			<?php endif; ?>
            <fieldset class="fieldset">
				<legend class="legend"><span>Customer Delete Account</span></legend>
                <div class="field choice">
					<p><?php echo $html; ?></p>
					<p>Once you have marked your data to be deleted or anonymised our system then your data cannot be restored.
					If you are sure to proceed the click "Continue" button.</p>
                </div>
            </fieldset>
            <div class="actions-toolbar">
                <div class="primary"><button type="submit" title="<?php /* @escapeNotVerified */ echo __('Continue') ?>" class="action save primary"><span><?php /* @escapeNotVerified */ echo __('Continue') ?></span></button></div>
            </div>
        </form>
<?php endif; ?>
