<?php
/**
 * Dotsquares
 * 
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade this extension to newer
 * version in the future.
 *
 * @author Dotsquares
 * @package Dotsquares_GDPR
 * @copyright Copyright (c) Dotsquares (https://www.dotsquares.com/)
 */

$helper = $this->helper('Dotsquares\Gdpr\Helper\Data');
$cookies = $helper->getConfig('cusotmerdelete/cookies/cookies_enable');
$cook_message = $helper->getConfig('cusotmerdelete/cookies/cookies_msg');
$website_message = $helper->getConfig('cusotmerdelete/cookies/websitepolicymsg');
$website_message = $block->filterOutputHtml($website_message);
$cook_message = $block->filterOutputHtml($cook_message);
$accountId = $block->getConfig(\Magento\GoogleAnalytics\Helper\Data::XML_PATH_ACCOUNT); 
$blockObj = $block->getLayout()->createBlock('\Magento\GoogleAnalytics\Block\Ga');
if ($cookies == 1) {
$gdpr_cookies = $block->getCookie();
if($gdpr_cookies != true):	?>
	
    <div class="dot_cookies">
        <?php echo $cook_message; ?>
		<div class="website_policy">
			<?php echo $website_message; ?>
			<button id="dot_cookies_accept" class="dot_cookies_accept">
				<span><?php echo 'Accept';?></span>
			</button>
			<button id="dot_cookies_decline" class="dot_cookies_decline">
				<span><?php echo 'Decline';?></span>
			</button>
		</div>
    </div>
<?php endif; ?>
    <script type="text/javascript">
        require([
			'jquery',
			'gdpr_cookie'
		],function($, cookies){
            cookies.init({
                "isCookieRestrictionModeEnabled": <?= (int)$blockObj->isCookieRestrictionModeEnabled() ?>,
                "currentWebsite": <?= (int)$blockObj->getCurrentWebsiteId() ?>,
                "cookieName": "<?= \Magento\Cookie\Helper\Cookie::IS_USER_ALLOWED_SAVE_COOKIE ?>",
                "ordersTrackingData": <?= json_encode($blockObj->getOrdersTrackingData()) ?>,
                "pageTrackingData": <?= json_encode($blockObj->getPageTrackingData($accountId)) ?>
            });
            $('#dot_cookies_accept').click(function() {
                $('.dot_cookies').hide();
                $.cookie('gdpr_cookies', "true", { expires:1, path: '/' });
            });
            $('#dot_cookies_decline').click(function() {
				$('.dot_cookies').hide();
                $.cookie('gdpr_cookies', "false", { expires: 1, path: '/' });
            });
        });
    </script>
    
<?php } ?>
